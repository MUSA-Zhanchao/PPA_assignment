---
title: 'Assignment 2: Neighborhood Indicators'
author: "Zhanchao Yang"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: journal
    highlight: tango
    toc: true
    toc_float: 
      collapsed: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(sf)
library(tidycensus)
library(tigris)
```

# Select the Data

## Neighborhood boundaries and analysis units/levels

In this study, I intend to analysis the neighborhoods indicators in the city
of Philadelphia at the census tract level. Census tracts closely align with neighborhood boundaries and effectively reflect economic and social dynamics. Compared to block-level data, census tracts have  relatively lower margin of errors when using American Community Survey (ACS) data, as the sample size is larger.

However, there are several limitations to this approach. First, neighborhood boundaries don't always align with the census tract boundaries and may cross multiple tracts. Second, census tracts level analysis fails to notice smaller trends within specific neighborhood blocks. For example, in one particular census tract, one block group may have well transit coverage, while another block group may have limited access to public transportation. This can lead to an overgeneralization of neighborhood trends. 

## Datasets selection
The datasets I used to calculate the economic indicators including following:

- Median household income at the census tract level across Philadelphia, gathered from the 2022 5-year American Communities Survey (ACS) data.

- The violent crime rate at the census tract level across Philadelphia gathered from the Philadelphia Police Department.

- The bus ridership data aggregated at census tract level across Philadelphia gathered from the SEPTA.

### Load ACS median income data

```{r, results='hide', warning=FALSE, message=FALSE}
# Load the ACS data
income<- get_acs(
  geography = "tract",
  variables = c(income= "B19013_001"),
  state = "PA",
  county = "Philadelphia",
  year = 2022,
  survey = "acs5",
  output = "wide",
  geometry = TRUE
)
```
### Load violent crime data and ridership data

```{r, results='hide', warning=FALSE, message=FALSE}
# Load the violent crime data
incident<- st_read("data/incident/incidents_part1_part2.shp")
# load the ridership data
ridership <- read_csv("data/bus.csv")
```

## Justification 
The median household income is a key indicator for measuring the residents' neighborhood financial well-being. A neighborhood with a relatively higher median income always indicates residents have sufficient funds to address their daily needs and enjoy a better quality of life. The number of violent crimes is a key indicator of public safety. A lower number of crimes suggests that the neighborhood is safe for everyone. The bus ridership data is a key indicator of public transportation availability. A higher number of bus ridership indicates that the neighborhood has a better public transportation connection and more vibrant economic activities, as visitors and residents frequently flow in and out.

## Limitations


# Process & clean the Data

### Cleaning the income data

Convert median income into the CRS 4326 and filter out the census tracts with the missing income data 

```{r, messge=FALSE, warning=FALSE}
income <- income %>% 
  st_transform(crs = 4326) %>% 
  filter(!is.na(incomeE))%>%
  select(-GEOID, -NAME)
```

### Cleaning the violent crime data

Remove unnecessary columns and convert the data into the CRS 4326
```{r, warning=FALSE, message=FALSE}
incident <- incident %>% 
  st_transform(crs = 4326) %>% 
  select(text_gener, geometry)
```

### Cleaning the ridership data

Step 1: Based a latitude and longitude of each stop points, converted the csv into a sf object
```{r, warning=FALSE, message=FALSE}
ridership <- ridership %>% 
  st_as_sf(coords = c("Lon", "Lat"), crs = 4326)
```

Step 2: First, calculate a variable called the `workday ridership` by summing the on and off ridership together; Second, calculate another new variable called the `weekend ridership` by summing the on and off ridership of Saturday and Sunday together and divded by 2; Finally, calculate a new variable called the `total ridership` by summing the `workday ridership` and `weekend ridership` together, which reflect the neighborhood dynamics for both weekend and weekdays.

```{r, warning=FALSE, message=FALSE}
ridership <- ridership %>% 
  mutate(workday_ridership = Weekday_On + Weekday_Of,
         weekend_ridership = (Saturday_O + Saturday_1 + Sunday_Ons + Sunday_Off)/2,
         total_ridership = workday_ridership + weekend_ridership) 
```

Step 3: cleaning the data only include the variable necessary for the analysis
```{r, warning=FALSE, message=FALSE}
ridership <- ridership %>% 
  select(total_ridership, workday_ridership, weekend_ridership, geometry)
```

# Perfrom Spatial Operations

# Visulization and Mapping

# Discussion

